const client = require("./clientController");
const { default: axios } = require("axios");

const Surah = async (from, message) => {
  const responseApi = await axios.get("https://quran-api.santrikoding.com/api/surah");
  const data = responseApi.data;
  const surah = data.find((item) => item.nama_latin === message);

  //   Start
  if (message === "start") {
    await client.sendMessage(
      from,
      "Selamat Datang di Bot Quran \nMasukkan perintah sesuai menu berikut :\n1. !random (Untuk mendapatkan random ayat) \n2. !surah (Untuk melihat list surah)\n3. nama_surah (Ketik nama surah yang diinginkan)"
    );
  } else if (message === "!random") {
    const nomor = Math.floor(Math.random() * 114) + 1;
    const responseDetailSurah = await axios.get(`https://quran-api.santrikoding.com/api/surah/${nomor}`);
    const data = responseDetailSurah.data;
    const rand = Math.floor(Math.random() * data.jumlah_ayat) + 1;
    const ayat = data.ayat[rand].nomor;

    try {
      await client.sendMessage(
        from,
        `Surah : ${data.nama_latin}
        \nArti : ${data.arti}
        \nJumlah Ayat : ${data.jumlah_ayat}
        \nRandom Ayat : ${ayat}
        \n${data.ayat[rand].ar}
        \n${data.ayat[rand].idn}`
      );
    } catch (error) {
      console.log(error);
      await sendMessage(from, "Terjadi kesalahan dalam memuat data");
    }

    // !Surah
  } else if (message === "!surah") {
    try {
      const surahText = data.map((surah) => `${surah.nomor}. ${surah.nama_latin}`).join("\n");
      await client.sendMessage(from, surahText);
    } catch (error) {
      console.log(error);
      await sendMessage(from, "Terjadi kesalahan dalam memuat data");
    }

    // Nama Surah
  } else if (message === surah.nama_latin) {
    try {
      const { nama_latin, jumlah_ayat, tempat_turun } = surah;
      await client.sendMessage(
        from,
        `Surah ${nama_latin} 
        \nJumlah Ayat : ${jumlah_ayat} 
        \nTempat Turun : ${tempat_turun}`
      );
    } catch (error) {
      console.log(error);
      await sendMessage(from, "Terjadi kesalahan dalam memuat data");
    }
  }
};

module.exports = Surah;
